<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.92.2" /><link rel="alternate" type="text/html" href="https://pages.github.com/geoffreymbrown/ab-tag/docs/building/printview/">
<META NAME="ROBOTS" CONTENT="INDEX, FOLLOW">


<link rel="shortcut icon" href="../../favicons/favicon.ico" >
<link rel="apple-touch-icon" href="../../favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="../../favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="../../favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="../../favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="../../favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="../../favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="../../favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="../../favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="../../favicons/android-192x192.png" sizes="192x192">

<title>Installation | Sub-gram Tags</title>


  <meta name="description" content="Installing and building software and hardware design files
">
<meta property="og:title" content="Installation" />
<meta property="og:description" content="Installing and building software and hardware design files
" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://pages.github.com/geoffreymbrown/ab-tag/docs/building/" /><meta property="og:site_name" content="Sub-gram Tags" />

<meta itemprop="name" content="Installation">
<meta itemprop="description" content="Installing and building software and hardware design files
"><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Installation"/>
<meta name="twitter:description" content="Installing and building software and hardware design files
"/>




<link rel="preload" href="../../scss/main.min.cf1ba784c866dfd22344d2170ede76e077419189fd476599431a2d2175446654.css" as="style">
<link href="../../scss/main.min.cf1ba784c866dfd22344d2170ede76e077419189fd476599431a2d2175446654.css" rel="stylesheet" integrity="">


<script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>

<script
  src="https://unpkg.com/lunr@2.3.8/lunr.min.js"
  integrity="sha384-vRQ9bDyE0Wnu+lMfm57BlYLO0/XauFuKpVsZPs7KEDwYKktWi5+Kz3MP8++DFlRY"
  crossorigin="anonymous"></script>


<link rel="stylesheet" type="text/css" href="../../hugo-cite.css" />
<link rel="stylesheet" href="https://unpkg.com/tachyons@4.12.0/css/tachyons.min.css" />
<link rel="stylesheet" href="https://unpkg.com/purecss@2.0.6/build/pure-min.css" integrity="sha384-Uu6IeWbM+gzNVXJcM9XV3SohHtmWE+3VGi496jvgX1jyvDTXfdK+rfZc8C1Aehk5" crossorigin="anonymous">








  </head>
  <body class="td-section">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
        <a class="navbar-brand" href="../../">
		<span class="navbar-logo"><svg id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 338.234 338.234" style="enable-background:new 0 0 338.234 338.234"><g><path d="M289.907 70.398c20.551-11.21 24.203-13.379 24.125-15.549-.018-.487-.257-1.166-1.296-1.639-2.043-.93-4.01-1.481-5.913-2.014-3.904-1.094-7.276-2.039-10.483-5.884-1.515-1.816-3.19-5.116-5.13-8.937-6.14-12.093-15.419-30.368-35.404-35.173C252.483.405 249.124.0 245.819.0c-12.257.0-23.432 5.395-32.315 15.601-9.916 11.393-16.38 27.889-19.213 49.032-3.556 26.537-42.166 76.738-65.234 106.733-7.831 10.182-14.017 18.224-16.415 22.217-8.857 14.743-25.584 34.13-39.025 49.708-15.501 17.967-23.576 27.509-23.246 31.08.065.704.411 1.118.69 1.341.385.308.888.464 1.496.464 4.94.0 21.448-12.124 36.73-24.104-10.402 10.931-23.707 25.778-36.707 40.287-4.024 4.491-7.98 8.905-11.752 13.093-11.723 13.017-18.132 24.048-16.326 28.104.458 1.028 1.393 1.595 2.632 1.595 3.332.0 8.409-4.028 12.082-7.408 6.64-6.111 10.544-8.385 12.035-8.495-.004.455-.375 1.779-2.126 4.342-3.955 5.787-5.545 10.701-4.255 13.145.51.967 1.432 1.5 2.595 1.5 2.449.0 5.959-2.402 9.885-6.758 10.59-11.749 46.677-45.226 64.02-61.312 4.808-4.46 8.038-7.463 8.834-8.244.229-.081 1.017-.245 3.72-.245 2.097.0 4.952.053 8.258.149 5.062.148 11.361.27 18.48.27.003.0.003.0.006.0 3.367.0 6.649-.047 9.865-.133.149 3.07-.095 6.791-1.18 7.6-.1.074-.245.166-.434.287-1.243.796-4.155 2.662-8.612 7.718-1.786 2.026-3.755 4.793-2.997 6.472.273.604.855.964 1.558.964h0c.848.0 1.87-.523 2.875-1.472 7.321-6.906 16.732-10.867 25.82-10.867 1.375.0 2.75.093 4.088.276 6.108.836 7.203 1.308 9.19 2.164.909.392 2.04.878 3.886 1.498.829.277 1.574-.159 1.718-.927.345-1.843-3.449-6.933-6.55-8.136-2.834-1.1-6.013-1.657-9.446-1.657-3.584.0-6.753.585-9.067 1.013-1.058.196-1.987.367-2.558.4-.083-1.309-.042-3.839.009-5.658 13.413-.703 25.416-2.22 36.051-4.577 7.512 4.517 14.442 8.799 15.146 9.566.333.453-.217 2.537-.619 4.059-.499 1.889-1.063 4.029-1.198 6.267-.182 3.016.872 5.597 1.928 6.718.473.502.972.756 1.484.756.355.0 1.521-.152 1.639-2.114.173-2.882 4.284-12.004 7.5-14.99 5.245-4.868 9.782-5.318 16.604-5.062 5.505.206 9.673 1.614 11.676 2.291.863.292 1.257.425 1.594.425h0c.402.0.756-.198.946-.53l.269-.593-.292-.5c-.685-1.175-4.476-5.904-10.507-7.565-3.481-.959-6.728-1.445-9.649-1.445-5.626.0-9.029 1.729-11.514 2.991-1.368.696-2.371 1.23-3.168 1.077-1.156-.226-4.804-2.165-9.259-4.731 13.639-4.382 24.52-10.496 32.798-18.398 41.914-40.009 39.871-88.999 30.776-123.104-2.477-9.288-5.682-16.022-8.021-20.938C278.059 80.821 276.563 77.677 289.907 70.398zM158.867 284z"/></g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/></svg></span><span class="text-uppercase font-weight-bold">Sub-gram Tags</span>
	</a>
	<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
		<ul class="navbar-nav mt-2 mt-lg-0">
			
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="../../background/" ><span>Background</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link active" href="../../docs/" ><i class='fas fa-book'></i><span class="active">Documentation</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="../../talks/" ><i class='fas fa-photo-video'></i><span>Talks</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				<a class="nav-link" href="https://github.iu.edu/geobrown/Nanotag-paper" target="_blank" ><i class='fab fa-github'></i><span>GitHub</span></a>
			</li>
			
			
			
		</ul>
	</div>
	<div class="navbar-nav d-none d-lg-block">



<input
  type="search"
  class="form-control td-search-input"
  placeholder="&#xf002; Search this site…"
  aria-label="Search this site…"
  autocomplete="off"
  
  data-offline-search-index-json-src="../../offline-search-index.3c9fbb5fe89aa2ae258dffb711ee3ddb.json"
  data-offline-search-base-href="../../"
  data-offline-search-max-results="10"
>

</div>
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
            
<div id="td-sidebar-menu" class="td-sidebar__inner">
  <div id="content-mobile">
  <form class="td-sidebar__search d-flex align-items-center">
    



<input
  type="search"
  class="form-control td-search-input"
  placeholder="&#xf002; Search this site…"
  aria-label="Search this site…"
  autocomplete="off"
  
  data-offline-search-index-json-src="../../offline-search-index.3c9fbb5fe89aa2ae258dffb711ee3ddb.json"
  data-offline-search-base-href="../../"
  data-offline-search-max-results="10"
>


    <button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type="button" data-toggle="collapse" data-target="#td-section-nav" aria-controls="td-docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    </button>
  </form>
  </div>
  <div id="content-desktop"></div>
  <nav class="collapse td-sidebar-nav" id="td-section-nav">
    <ul class="td-sidebar-nav__section pr-md-3 ul-0">
      <li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id="m--li">
  <a href="../../" class="align-left pl-0 td-sidebar-link td-sidebar-link__section tree-root" id="m-"><span class="">About</span></a>
  <ul class="ul-1">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-background-li">
  <a href="../../background/" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id="m-background"><span class="">Background</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id="m-docs-li">
  <a href="../../docs/" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id="m-docs"><span class="">Documentation</span></a>
  <ul class="ul-2 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsbittag-li">
  <a href="../../docs/bittag/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docsbittag"><span class="">BitTag</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-docsuserguides-li">
  <a href="../../docs/userguides/" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id="m-docsuserguides"><span class="">User Guides</span></a>
  <ul class="ul-3 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-docsuserguidespreflight-li">
  <a href="../../docs/userguides/preflight/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docsuserguidespreflight"><span class="">Preparing for Flight</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-docsuserguidesqtmon-li">
  <a href="../../docs/userguides/qtmon/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docsuserguidesqtmon"><span class="">Tag Configuration</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-docsuserguideslegharness-li">
  <a href="../../docs/userguides/legharness/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docsuserguideslegharness"><span class="">Loop Harnesses</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-docsuserguidesbtviz-li">
  <a href="../../docs/userguides/btviz/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docsuserguidesbtviz"><span class="">Visualization</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-docsuserguidescli-li">
  <a href="../../docs/userguides/cli/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docsuserguidescli"><span class="">Command-Line Tools</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child collapse" id="m-docsuserguidesfabrication-li">
  <a href="../../docs/userguides/fabrication/" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id="m-docsuserguidesfabrication"><span class="">Fabrication</span></a>
  <ul class="ul-4 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-docsuserguidesfabricationtools-li">
  <a href="../../docs/userguides/fabrication/tools/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docsuserguidesfabricationtools"><span class="">Tools</span></a>
</li>
  </ul>
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-docsarchitecture-li">
  <a href="../../docs/architecture/" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id="m-docsarchitecture"><span class="">Tag Architecture</span></a>
  <ul class="ul-3 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-docsarchitecturehardware-li">
  <a href="../../docs/architecture/hardware/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docsarchitecturehardware"><span class="">Hardware Architecture</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-docsarchitecturesoftware-li">
  <a href="../../docs/architecture/software/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docsarchitecturesoftware"><span class="">Software Architecture</span></a>
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docscustom-li">
  <a href="../../docs/custom/" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id="m-docscustom"><span class="">Custom Tags</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id="m-docsbuilding-li">
  <a href="../../docs/building/" class="align-left pl-0 active td-sidebar-link td-sidebar-link__section" id="m-docsbuilding"><span class="td-sidebar-nav-active-item">Installation</span></a>
  <ul class="ul-3 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsbuildingoverview-li">
  <a href="../../docs/building/overview/" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id="m-docsbuildingoverview"><span class="">Software Tools/Libraries</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsbuildingsoftware-li">
  <a href="../../docs/building/software/" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id="m-docsbuildingsoftware"><span class="">Building Host Software</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsbuildinghardware-li">
  <a href="../../docs/building/hardware/" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id="m-docsbuildinghardware"><span class="">Building Hardware</span></a>
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docslicense-li">
  <a href="../../docs/license/" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id="m-docslicense"><span class="">Licenses</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docsacknowledgement-li">
  <a href="../../docs/acknowledgement/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docsacknowledgement"><span class="">Acknowledgement</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-docscontact-li">
  <a href="../../docs/contact/" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id="m-docscontact"><span class="">Contacts</span></a>
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id="m-talks-li">
  <a href="../../talks/" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id="m-talks"><span class="">Talks</span></a>
</li>
  </ul>
</li>
    </ul>
  </nav>
</div>

          </aside>
          <aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none">
            
  
  
  
  
  
  
  <div class="td-page-meta ml-2 pb-1 pt-2 mb-0">
  
  
    <a id="print" href="https://pages.github.com/geoffreymbrown/ab-tag/docs/building/printview/"><i class="fa fa-print fa-fw"></i> Print entire section</a>
  
  </div>


            


<div class="td-toc"><nav id="TableOfContents">
  <ul>
    <li><a href="#install-1">1. Installing the Repository</a></li>
    <li><a href="#2-installing-the-cmake-build-tool">2. Installing the CMake Build Tool</a>
      <ul>
        <li><a href="#additional-installation-for-windows">Additional Installation For Windows</a></li>
        <li><a href="#building-with-cmake-additional-softare-required">Building with CMake (additional softare required)</a></li>
      </ul>
    </li>
    <li><a href="#3-building-on-os-x">3. Building on OS X</a></li>
    <li><a href="#3-building-on-windows">3. Building on Windows</a></li>
  </ul>

  <ul>
    <li><a href="#programming-with-stm32cube-programmer">Programming with STM32Cube Programmer</a>
      <ul>
        <li><a href="#dfu-for-base-boards">DFU for base boards</a></li>
      </ul>
    </li>
  </ul>
</nav></div>



            

	
		



  
  

	
		



  
  

	

          </aside>
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            
  

            
            
<div class="td-content">
	<h1>Installation</h1>
  <div class="lead">Installing and building software and hardware design files</div>
	<header class="article-meta">
		
		
			
				


			
				


			
		
		
	</header>
	<p>The tag system consists of software, both host and embedded, and hardware including printed circuit boards (PCBs) and 3D printed adapters.  Consequently, there are a relatively large number of software tools involved.   All of the software and
hardware designs (source code) are available in the <a href="https://git.iu.edu/geobrown/Nanotag-paper">github repository</a>.  While you can explore that repository on-line, in order to compile the code and generate the processing files necessary to build boards, it is necessary to first
<em>clone</em> the repository as described in <a href="#install-1">Installing the Repository</a></p>
<p>An
abbreviated view of this repository is shown in the following
figure. There are two directories containing the designs for
this project &ndash; software and hardware.  Two directories that
reference code from other projects as <em>submodules</em> &ndash; nanopb, which
provides the compiler and libraries for the communication protocols
used to exchange data and control messages with the tags, and
ChibiOS, which is the embedded operating system (RTOS) used in the
tags.  Finally there is a directory (cmake) and files (CMakeLists.txt) used by the CMake build system.</p>
<p><strong>Note</strong> it&rsquo;s better to install nanopb from the available binary as this is less likely to have version problems with the install protoc</p>
<pre tabindex="0"><code>.
├── ChibiOS
├── cmake
├── CMakeLists.txt
├── hardware
│   ├── AccelTag
│   ├── BitTagv5
│   ├── BitTagv7
│   ├── CMakeLists.txt
│   ... 
│   ├── Mechanical
│   ...
├── nanopb
├── README.md
└── software
    ├── CMakeLists.txt
    ├── embedded
    ├── host
    ├── include
    └── proto
</code></pre><p>The hardware directory contains a separate directory for each board,
libraries used by the Kicad, the computer aided design system (CAD) that we use to design hardware, and a directory of mechanical
components (Mechanical) that includes the design files for the 3D
printed bases.</p>
<p>The software directory includes separate sub-directories for embedded and host code, and a directory for the protocol definitions used to communicate between the host and the tags.</p>
<p>All of the software and hardware for tags can be compiled (built) on Windows, OS X, or Linux.  Enabling this process requires
installing a number of programs and libraries.  There are
differences in the installation and build process for the three
platforms that will be called out.  In this section we describe
the processes for <em>cloning</em> the tag repository and installing the CMake build system.  The tools and libraries required to perform a build are discussed in separate sections for
hardware and software.</p>
<h2 id="install-1">1. Installing the Repository</h2>
<p>In order to install the repository, you should use the program <code>git</code>, which is available on Windows, OS X, and Linux. Instructions
for installing <code>git</code> can be found <a href="https://git-scm.com/downloads">here</a></p>
<p>Once git is installed, copy the git repo link (for https) and execute the following in a terminal within the directory where you would like the repo installed</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">git clone https://github.iu.edu/geobrown/NanoTag-paper.git target_directory_name
<span style="color:#204a87">cd</span> target_directory_name
git submodule update --init --recursive 
</code></pre></div><p>The repository for this project includes one <em>submodules</em> &ndash; ChibiOS; these are external repositories upon which our system builds. Nanopb used to be installed as a submodule but it&rsquo;s best to install the available binary distribution in the named directory. Nanopb is a code library and tool for creating the communication code used in our tags to communicate with the host applications.  ChibiOS is an excellent embedded operating systems that is used on our tags.</p>
<p>The line <code>git submodule...</code> initializes these submodules and clones their contents.</p>
<h2 id="2-installing-the-cmake-build-tool">2. Installing the CMake Build Tool</h2>
<p>In order to automate the process of <em>building</em> the various system components, we use
the CMake tool.  This tool checks for the presence of all other necessary tools and issues warnings for any tools that are missing.</p>
<p><a href="https://cmake.org/download/">Cmake on OS X</a></p>
<h3 id="additional-installation-for-windows">Additional Installation For Windows</h3>
<p>make &ndash; gnu make is needed for building embedded software.  The easiest way to install gnu make is with the <code>chocolaty</code> package manager.  <a href="https://community.chocolatey.org/packages/make">choco</a></p>
<p>Setting up paths  <a href="https://david.gardiner.net.au/2020/04/powershell-visualstudio-integration.html">https://david.gardiner.net.au/2020/04/powershell-visualstudio-integration.html</a>
<a href="https://docs.microsoft.com/en-us/visualstudio/ide/reference/command-prompt-powershell?view=vs-2019#windows-10">https://docs.microsoft.com/en-us/visualstudio/ide/reference/command-prompt-powershell?view=vs-2019#windows-10</a></p>
<h3 id="building-with-cmake-additional-softare-required">Building with CMake (additional softare required)</h3>
<p>Assuming all the necessary tools are installed the build process consists of creating a build directory, running CMake from within that directory, and then <em>making</em> any desired components.  On a linux system, for example, the following sequence of commands will build the BitTag data visualization tool <code>btviz</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">mkdir build_directory
<span style="color:#204a87">cd</span> build_directory
cmake path_to_repository
make btviz
</code></pre></div><p>The first two lines create a directory in which to <em>build</em> the system components;
the third line populates this directory with the scripts necessary to perform the build (in this case Unix &ldquo;make&rdquo; files); finally, the fourth line builds the &ldquo;target&rdquo; btviz.<br>
Continuing the example, one can build and download the firmware to a BitTag (e.g. v6) that is connected to a base:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">make BitTagv6-download
</code></pre></div><p>The CMake build tool can be installed from <a href="https://cmake.org/download/">here</a>.</p>
<p>The various software <em>targets</em> that can be built include</p>
<ul>
<li>Host Tools
<ul>
<li>qtmonitor &ndash; the tag configuration tool</li>
<li>btviz &ndash; the BitTag visualization tool</li>
<li>various command-line tools</li>
</ul>
</li>
<li>Tags
<ul>
<li>AccelTag &ndash; Tag design with ST Accelerometer</li>
<li>BitTagv5 &ndash; BitTag with rv-8803 temperature compensated RTC</li>
<li>BitTagv7 &ndash; BitTag with rv-3028 45nA RTC</li>
<li>LuxTag   &ndash; Tag design with light sensor</li>
<li>NucleoTag &ndash; Tag &ldquo;design&rdquo; using STM Nucleo board for demonstration</li>
<li>PresTAg  &ndash; Tag design with LPS27 Pressure sensor</li>
</ul>
</li>
<li>Bases
<ul>
<li>bittag-base-jlcpcb-v3[-dfu] &ndash; Tag base (-dfu for programming)</li>
<li>tag-breakout-base-jlcpcb32-v1[-dfu] &ndash; Tag breakout board stlink interface</li>
</ul>
</li>
</ul>
<p>In addition, cmake files are provided for generating gerber and outline files for the following hardware:</p>
<ul>
<li>AccelTag-pcb &ndash; AccelTag board</li>
<li>tagbase-jlcpcb-v3 &ndash; Tag base board</li>
<li>MultiCharger-pcb &ndash; Tag charger board</li>
</ul>
<p>Finally, the 3d printed tag adapter for BitTags can be generated</p>
<ul>
<li>multicharger-acrylic</li>
</ul>
<h2 id="3-building-on-os-x">3. Building on OS X</h2>
<p>The process for building on OS X is similar to that for Linux except that OS X applications are typically <em>bundled</em> into
<code>.app</code> directories.  To build these bundles, we depend upon
a tool, <code>macdeployqt</code>, that combines the compiled (host) applications
with any necessary libraries in an <code>.app</code> directory.  The
installation of Qt5 is discussed in the section on Software.  In order  for CMake to find <code>macdeployqt</code>, you must make sure that
the directory <code>qt/5.15.1/bin</code> is included in your bash path &ndash; note that version number 5.15.1 should be changed to fit the version of Qt5 installed.</p>
<p>All of the OS X applications created by make can be <em>packed</em> into
a singled <code>.dmg</code> file for distribution to other users.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#204a87">cd</span> build_directory
cpack -G DragNDrop
</code></pre></div><h2 id="3-building-on-windows">3. Building on Windows</h2>
<p>Unfortunately, the process for building on Windows is
significantly more complicated than for other platforms.  The
fundamental reason for this is the lack of a coherent <em>path</em> mechanism,
within a terminal window, for scripts to find applications.  This problem is particularly acute when using the compilation tools
in Visual Studio from a command line.  To mitigate this problem you
must:</p>
<ul>
<li>Use the powershell window configured for Visual Studio</li>
<li>Modify the powershell path environment variable</li>
<li>Use vcpkg to manage the various software libaries</li>
</ul>
<p>Powershell integration with visual studio is described <a href="https://david.gardiner.net.au/2020/04/powershell-visualstudio-integration.html">here</a> and <a href="https://docs.microsoft.com/en-us/visualstudio/ide/reference/command-prompt-powershell?view=vs-2019#windows-10">here</a>.  Briefly,
when Visual Studio 2019 is installed, a &ldquo;Developer PowerShell for VS 2019&rdquo; is made available in the Start menu.  This PowerShell instance has many of the required path variables installed.</p>
<p>In addition, the path environment variables should be
modified (described <a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_environment_variables?view=powershell-7.1">here</a>) to include the
paths to the various tools used in the build process (CMake, STM32_Programmer_CLI,FMPP, etc.)</p>
<p>Finally, we use vcpkg to manage the various software libraries (described in the Software section).</p>
<p>With all that accomplished, the process of building becomes</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">mkdir build_directory
<span style="color:#204a87">cd</span> build_directory
cmake -G <span style="color:#4e9a06">&#34;Visual Studio 16 2019&#34;</span> -Ax64 -DVCPKG_TARGET_TRIPLET<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;x64-windows-static&#34;</span> -DCMAKE_TOOLCHAIN_FILE<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;path_to/vcpkg/scripts/buildsystems/vcpkg.cmake&#34;</span>  path_to_nanotag_repo
cmake --build . --config Release
</code></pre></div><p>The differences with Linux are, lines 3 and 4.  In line 3,
CMake is directed to configure the build for Visual Studio 2019 using the toolchain file from vcpkg and for a static x64 target.
Line 4 performs the actual build (this configuration does not use make files).</p>
<p>In addition to a Release configuration, one can build a Debug configuration:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">cmake --build . --config Debug
</code></pre></div><p>One can build and download tags as in</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">cmake --build . --target <span style="color:#ce5c00;font-weight:bold">[</span>BitTagv6<span style="color:#000;font-weight:bold">|</span>BitTagv5<span style="color:#000;font-weight:bold">|</span>NucleoTag<span style="color:#ce5c00;font-weight:bold">]</span>
cmake --build . --target BitTagv6-download
</code></pre></div><p>Furthermore, one can erase tags as in</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">cmake --build . --target BitTagv6-erase.
</code></pre></div><p>Finally, one can build and download baseboard firmware:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">cmake --build . --target bittag-base-jlcpcb-v3
cmake --build . --target bittag-base-jlcpcb-v3-dfu
</code></pre></div><h1 id="building-with-os-x">building with OS X</h1>
<p>Use the &ldquo;brew&rdquo; version of QT because it links statically.</p>
<p>Make sure to add /usr/local/Cellar/qt/5.15.1/bin (or current version) to your path so that the various find_program tools work (esp macdeployqt)</p>
<p>Building the dmg file for system toos</p>
<p>cpack -G DragNDrop</p>
<h1 id="2-embedded-software">2. Embedded Software</h1>
<p>Compiling and downloading embedded software requires several additional tools.</p>
<ul>
<li><a href="https://developer.arm.com/tools-and-software/open-source-software/developer-tools/gnu-toolchain/gnu-rm">gnuarm</a></li>
<li><a href="http://fmpp.sourceforge.net/">fmpp</a></li>
<li>gnu make</li>
</ul>
<p>The primary toolchain for the stm32 processors used in all our devices is the free gunarm toolchain.  ChibiOS designs additionally require the freemarker-based file preprocessor (a java application).  On Windows it will also be necessary to install gnu make (for example from chocolaty).</p>
<p>We utilize the STMicroelectronics <a href="https://wiki.st.com/stm32mpu/wiki/STM32CubeProgrammer">stm32cube programmer</a> to program and erase both tags and baseboards.</p>
<h2 id="programming-with-stm32cube-programmer">Programming with STM32Cube Programmer</h2>
<p>The cmake configuration files include rules to download and erase tags and bases.  It is also possible to use the programmer from the command line.  The following illustrates this process on Windows.</p>
<pre tabindex="0"><code>~/Software/STM32CubeProgrammer/bin/STM32_Programmer_CLI.exe -c port=SWD mode=UR -d ch.elf -v -g 0x08000000 
</code></pre><ul>
<li><code>port=SWD</code> driver</li>
<li><code>mode=UR</code> &ndash; attach under reset</li>
<li><code>-g 0x08000000</code>  &ndash; execute program after completion</li>
<li><code>-v</code> verify</li>
<li><code>-vb 3</code>  verbose logging (for debugging)</li>
</ul>
<h3 id="dfu-for-base-boards">DFU for base boards</h3>
<p>The base boards do not have a arm debug interface and
hence are programmed using DFU mode.  To put the device in DFU mode, plug in USB while holding down the dfu button on the device.</p>
<p>Make sure a device is in dfu mode</p>
<pre tabindex="0"><code>STM32_Programmer_CLI.exe -l usb
</code></pre><p>To program from command line</p>
<pre tabindex="0"><code> ~/Software/STM32CubeProgrammer/bin/STM32_Programmer_CLI -c port=usb1 -d build/ch.elf 
</code></pre>
        <div class="section-index">
    
    
    
    
    
    
    
    
    <hr class="panel-line">
        
            
            <div class="entry">
                <h5>
                    <a href="../../docs/building/overview/">Software Tools/Libraries</a>
                </h5>
                <p></p>
            </div>
        
            
            <div class="entry">
                <h5>
                    <a href="../../docs/building/software/">Building Host Software</a>
                </h5>
                <p></p>
            </div>
        
            
            <div class="entry">
                <h5>
                    <a href="../../docs/building/hardware/">Building Hardware</a>
                </h5>
                <p></p>
            </div>
        
    
</div>

	
	
	<div class="text-muted mt-5 pt-3 border-top">

</div>

</div>

          </main>
        </div>
      </div>
      
<footer class="bg-dark py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
        
        
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
    <a class="text-white" target="_blank" rel="noopener" href="https://github.com/google/docsy" aria-label="GitHub">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-12 col-sm-4 text-center py-2 order-sm-2">
        <small class="text-white">&copy; 2022 Geoffrey Brown All Rights Reserved</small>
        
	
      </div>
    </div>
  </div>
</footer>


    </div>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js" integrity="sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF" crossorigin="anonymous"></script>


<script src="https://cdn.jsdelivr.net/npm/mermaid@8.11.2/dist/mermaid.min.js" integrity="sha384-m8Pdaep6Qk8sW3J6XhPOiwUww3maU9HxZTLvEfSEB4e1UVvTdHyfJsYmEfYqvwLC" crossorigin="anonymous"></script>




<script src='../../js/tabpane-persist.js'></script>




 

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.2/dist/katex.min.css" integrity="sha384-Cqd8ihRLum0CCg8rz0hYKPoLZ3uw+gES2rXQXycqnL5pgVQIflxAUDS7ZSjITLb5" crossorigin="anonymous">

<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.2/dist/katex.min.js" integrity="sha384-1Or6BdeNQb0ezrmtGeqQHFpppNd7a/gw29xeiSikBbsb44xu3uAo8c7FwbF5jhbd" crossorigin="anonymous"></script>
 


<script defer src='https://cdn.jsdelivr.net/npm/katex@0.13.2/dist/contrib/auto-render.min.js' integrity='sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl' crossorigin='anonymous' onload='renderMathInElement(document.body, {"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"},{"display":true,"left":"\\[","right":"\\\\]"}]});'></script>














<script src="../../js/main.min.a558dfc930f89b04cfee47eebf104ce100ee260e60b8e1a14a4b6a7b1f1025a1.js" integrity="sha256-pVjfyTD4mwTP7kfuvxBM4QDuJg5guOGhSktqex8QJaE=" crossorigin="anonymous"></script>




  </body>
</html>